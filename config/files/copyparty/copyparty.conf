# -*- mode: yaml; -*-

# Template from:
# https://github.com/9001/copyparty/blob/hovudstraum/docs/example.conf

# append some arguments to the commandline;
# accepts anything listed in --help (leading dashes are optional)
# and inline comments are OK if there is 2 spaces before the '#'
[global]
  name: Copyparty
  name-url: https://party.kristofferbalintona.me/
  # Indexing
  e2dsa         # File indexing and filesystem scanning
  re-maxage: 60  # Re-index every 60 seconds; see also --db-act and the :c volflag
  e2ts          # Multimedia indexing
  # Account info
  usernames
  ah-alg: argon2
  show-ah-salt
  ah-salt: 880jUWho350b058O6y1WfmdD
  # Reverse proxy settings
  rproxy: 1
  # We isolate Copyparty in its own network container and use a
  # reverse proxy to direct traffic into this network. As such, client
  # IPs originate from within this network. To show actual IP
  # locations, we tell Copyparty to trust and make use of the
  # X-Forwarded-For HTTP header that Caddy attaches to its outgoing
  # traffic. (This assumes Caddy is receiving packets with the actual
  # IP; this is only true if Caddy is on the host network or receives
  # traffic from another reverse proxy that attached that header.) See
  # https://github.com/9001/copyparty?tab=readme-ov-file#reverse-proxy
  # for more information
  xff-src: lan
  # Use Unix Domain Sockets (UDS) instead of TCP. Create a socket
  # (then share this with other containers in a shared volume) and
  # give it 770 permissions.
  #
  # Slightly faster performance because of less overhead. The chief
  # motivation to use UDS is security via reducing failure modes:
  # using sockets on shared container volumes removes the need to
  # publish ports and lets one leverage user (UID) and group (GID)
  # file permissions, which is more robust against firewall and
  # container misconfiguration.
  i: unix:770:/run/user/1000/copyparty/copyparty.sock
  # Other
  hist: hists/                  # Centralize metadata
  ansi                          # Enable colors in log messages
  qr
  no-robots                     # Equivalent effect to robots.txt
  
# Create users.  I hash my passwords (--ah-alg).  I also have
# --usernames, meaning the hash below is the result of
# USERNAME:PASSWORD as the password inputted in e.g. --ah-gen and
# --ah-cli.
[accounts]
  krisbalintona: +2JlSt_eC1b-2QvOigxJE2LcdcVBJOWbI

[groups]
  admin: krisbalintona

# create volumes:
[/]
  /data/root/
  accs:
    r: *
    A: @admin

[/secrets]
  /data/secrets/
  accs:
    A: @admin
  flags:
    fka
    dk
  
[/biblio]
  /data/biblio/
  accs:
    g: *
    A: @admin
  flags:
    dk
    fka

[/dump]
  /data/root/dump/
  accs:
    A: @admin
  flags:
    e2d     # the e2d volflag enables the uploads database
    nodupe  # the nodupe volflag rejects duplicate uploads
